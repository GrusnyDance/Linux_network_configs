## Part 1. Инструмент ipcalc

### Адрес сети 192.167.38.54/13
![task_1_1](./screens/1.1.png)
<b>Адрес сети - 192.160.0.0</b>

### Перевод масок
![task_1_2](./screens/1.2.png)
<b>Префиксная запись - /24, двоичная - 11111111.11111111.11111111.00000000</b>

![task_1_3](./screens/1.3.png)
<b>Обычная запись - 255.254.0.0, двоичная - 11111111.11111110.00000000.00000000</b>

![task_1_4](./screens/1.4.png)
<b>Обычная запись - 255.255.255.240, префиксная - /28</b>

### Минимальный / максимальный хост в сети 12.167.38.4
- с маской /8
![task_1_5](./screens/1.5.png)
<b>HostMin - 12.0.0.1, HostMax - 12.255.255.254</b>

- с маской 11111111.11111111.00000000.00000000
![task_1_6](./screens/1.6.png)
<b>HostMin - 12.167.0.1, HostMax - 12.167.255.254</b>

- с маской 255.255.254.0
![task_1_7](./screens/1.7.png)
<b>HostMin - 12.167.38.1, HostMax - 12.167.39.254</b>

- с маской /4
![task_1_8](./screens/1.8.png)
<b>HostMin - 0.0.0.1, HostMax - 15.255.255.254</b>

### Localhost
Диапазон localhost: 127.0.0.1 — 127.255.255.254

- 194.34.23.100 - не localhost
- 127.0.0.2 - localhost
- 127.1.0.1 - localhost
- 128.0.0.1 - не localhost


### Диапазоны и сегменты сетей

Диапазоны выделенные локальным сетям:
- 10.0.0.0 — 10.255.255.255
- 100.64.0.0 — 100.127.255.255
- 172.16.0.0 — 172.31.255.255
- 192.168.0.0 — 192.168.255.255

- 10.0.0.45 - частный
- 134.43.0.2 - публичный
- 192.168.4.2 - частный 
- 172.20.250.4 - частный
- 172.0.2.1 - публичный
- 192.172.0.1 - публичный
- 172.68.0.2 - публичный
- 172.16.255.255 - частный
- 10.10.10.10 - частный
- 192.169.168.1 - публичный

IP адреса шлюза у сети 10.10.0.0/18:

![task_1_9](./screens/1.9.png)
<b>10.10.0.0/18</b>

- 10.0.0.1 - неверный
- 10.10.0.2 - верный
- 10.10.10.10 - верный
- 10.10.100.1 - неверный
- 10.10.1.255 - верный

## Part 2. Статическая маршрутизация между двумя машинами

![task_2_1](./screens/2.1.png)
<b>Вывод команды ip a, одинаковый на обеих машинах</b>

Задать следующие адреса и маски: 
- ws1 - 192.168.100.10/16
- ws2 - 172.24.116.8/12

![task_2_2](./screens/2.2.png)
<b>Задать статический IP адрес на машине 1</b>

![task_2_3](./screens/2.3.png)
<b>Задать статический IP адрес на машине 2</b>

### Добавление статического маршрута вручную

![task_2_4](./screens/2.4.png)
<b>Задать статический IP адрес на машине 1</b>

![task_2_5](./screens/2.5.png)
<b>Задать статический IP адрес на машине 2</b>

### Добавление статического маршрута с сохранением

![task_2_6](./screens/2.6.png)
<b>Добавить статический маршрут от одной машины до другой с помощью файла etc/netplan/00-installer-config.yaml</b>

![task_2_7](./screens/2.7.png)
<b>Добавить статический маршрут от одной машины до другой с помощью файла etc/netplan/00-installer-config.yaml</b>

![task_2_8](./screens/2.8.png)
<b>Пинг машины 1</b>

![task_2_9](./screens/2.9.png)
<b>Пинг машины 2</b>

## Part 3. Утилита iperf3

- 8 Mbps = 1 MB/s (мегабиты в мегабайты)
- 100 MB/s = 819200 Kbps (мегабайты в килобиты)
- 1 Gbps = 1024 Mbps (гигабиты в мегабиты)

**Скорость соединения между ws1 и ws2**

![task_3_1](./screens/3.1.png)
<b>Запуск iperf на сервере</b>

![task_3_2](./screens/3.2.png)
<b>Запуск iperf на клиенте</b>

## Part 4. Сетевой экран

![task_4_1](./screens/4.1.png)
<b>Порядок прохождения пакетов через брандмауэр</b>

[Документация по iptables](https://www.opennet.ru/docs/RUS/iptables/)

![task_4_2](./screens/4.2.png)
<b>/etc/firewall машина 1</b>

![task_4_3](./screens/4.3.png)
<b>/etc/firewall машина 2</b>

После того как сработали запрещающие правила, они не заменяются разрешающими

**Запуск скриптов**

```
chmod +x /etc/firewall.sh
```
![task_4_4](./screens/4.4.png)
<b>iptables -L</b>

![task_4_5](./screens/4.5.png)
<b>iptables -L</b>

### Утилита nmap

![task_4_6](./screens/4.6.png)
<b>вывод команды nmap</b>

## Part 5. Статическая маршрутизация сети

### 5.1. Настройка адресов машин

Конфигурации машин:

![task_5_1](./screens/5.1.png)

![task_5_2](./screens/5.2.png)

![task_5_3](./screens/5.3.png)

![task_5_4](./screens/5.4.png)

![task_5_5](./screens/5.5.png)

Пропинговать ws22 с ws21, пропинговать r1 с ws11

![task_5_6](./screens/5.6.png)

![task_5_7](./screens/5.7.png)



### 5.2. Включение переадресации IP-адресов

Изменить файл /etc/sysctl.conf на обоих роутерах
```
net.ipv4.ip_forward = 1
sysctl -p /etc/sysctl.conf 
```

![task_5_8](./screens/5.8.png)

![task_5_9](./screens/5.9.png)


### 5.3. Установка маршрута по-умолчанию

Настроить маршрут по-умолчанию (шлюз) для рабочих станций. Для этого добавить gateway4 [ip роутера] в файле конфигураций

![task_5_10](./screens/5.10.png)

Вызвать ip r и показать, что добавился маршрут в таблицу маршрутизации

![task_5_11](./screens/5.11.png)

Пропинговать с ws11 роутер r2 и показать на r2, что пинг доходит

![task_5_12](./screens/5.12.png)

### 5.4. Добавление статических маршрутов

Добавить в роутеры r1 и r2 статические маршруты в файле конфигураций

![task_5_13](./screens/5.13.png)

![task_5_14](./screens/5.14.png)

Вызвать ip r и показать таблицы с маршрутами на обоих роутерах

![task_5_15](./screens/5.15.png)

##### Запустить команды на ws11:
`ip r list 10.10.0.0/[маска сети]` и `ip r list 0.0.0.0/0`

![task_5_16](./screens/5.16.png)

![task_5_17](./screens/5.17.png)
<b>комент по поводу дефолтной сети</b>

### 5.5. Построение списка маршрутизаторов

При помощи утилиты traceroute построить список маршрутизаторов на пути от ws11 до ws21

![task_5_18](./screens/5.18.png)

traceroute передвигается по маршрутам по умолчанию, отправляет по 3 пакета, засекает время

### 5.6. Использование протокола ICMP при маршрутизации

Запустить на r1 перехват сетевого трафика, проходящего через eth0 с помощью команды: tcpdump -n -i eth0 icmp

Пропинговать с ws11 несуществующий IP (например, 10.30.0.111) с помощью команды: ping -c 1 10.30.0.111

![task_5_19](./screens/5.19.png)

## Part 6. Динамическая настройка IP с помощью DHCP


Для r2 настроить в файле /etc/dhcp/dhcpd.conf конфигурацию службы DHCP. Указать адрес маршрутизатора по-умолчанию, DNS-сервер и адрес внутренней сети.

```
apt install isc-dhcp-server
vim /etc/dhcp/dhcpd.conf
```

![task_6_1](./screens/6.1.png)

В файле resolv.conf прописать nameserver 8.8.8.8.

![task_6_2](./screens/6.2.png)
<b>настройка не имеет смысла</b>

`systemctl restart isc-dhcp-server`

![task_6_3](./screens/6.3.png)
<b>меняем настройки получения ip-адреса на машине ws21 на динамические</b>

![task_6_4](./screens/6.4.png)
<b>видим что адрес на интерфейсе enp0s8 находится в диапазоне заданном на маршрутизаторе</b>

![task_6_5](./screens/6.5.png)
<b>на машине ws22 адрес задается по прежнему статически, при этом машина пингуется с ws21 и наоборот</b>

**Указать MAC адрес у ws11, для этого в etc/netplan/00-installer-config.yaml надо добавить строки: macaddress: 10:10:10:10:10:BA, dhcp4: true**

![task_6_6](./screens/6.6.png)

**Для r1 настроить аналогично r2, но сделать выдачу адресов с жесткой привязкой к MAC-адресу (ws11)**

![task_6_7](./screens/6.7.png)

[Статья про конфигурацию dhcp](https://www.opennet.ru/base/net/dhcp_setup.txt.html)

#### ПОСЛЕ ТОГО КАК РУКАМИ ПОМЕНЯЛИ МАК АДРЕС В КОНФИГАХ НАДО ЕГО ПРОПИСАТЬ В НАСТРОЙКАХ ВИРТУАЛЬНОЙ МАШИНЫ, ИНАЧЕ ОНА НЕ ЗАГРУЗИТСЯ❤

Тесты на видимость в локальной сети работают, но доступ в интернет роутеры не выдают. Если переписать приоритет дефолтных шлюзов, можно поднять адаптер nat, но тогда пропадет локальная сеть. Вообще DNS сервер в файле resolv.conf не имеет смысла, тк файл переписывается каждый раз когда происходит рестарт dhcp.

Чекнуть [видос](https://www.youtube.com/watch?v=HDpCo7DvsgY)

**Запросить с ws21 обновление ip адреса**

![task_6_8](./screens/6.8.png)

## Part 7. NAT

В файле /etc/apache2/ports.conf на ws22 и r1 изменить строку Listen 80 на Listen 0.0.0.0:80, то есть сделать сервер Apache2 общедоступным

`apt install apache2`

![task_7_1](./screens/7.1.png)

![task_7_2](./screens/7.2.png)

Запустить веб-сервер Apache командой service apache2 start на ws22 и r1

Добавить в фаервол, созданный по аналогии с фаерволом из Части 4, на r2 следующие правила:

- Удаление правил в таблице filter - iptables -F

- Удаление правил в таблице "NAT" - iptables -F -t nat

- Отбрасывать все маршрутизируемые пакеты - iptables --policy FORWARD DROP

![task_7_3](./screens/7.3.png)

Проверить соединение между ws22 и r1 командой ping

![task_7_4](./screens/7.4.png)

Разрешить маршрутизацию всех пакетов протокола ICMP, проверить соединение между ws22 и r1 командой ping

![task_7_5](./screens/7.5.png)

![task_7_6](./screens/7.6.png)

Добавить в файл ещё два правила:

- Включить SNAT, а именно маскирование всех локальных ip из локальной сети, находящейся за r2 (по обозначениям из Части 5 - сеть 10.20.0.0)
- Включить DNAT на 8080 порт машины r2 и добавить к веб-серверу Apache, запущенному на ws22, доступ извне сети

![task_7_7](./screens/7.7.png)

Проверить соединение по TCP для SNAT, соединение по TCP для DNAT

![task_7_8](./screens/7.8.png)

![task_7_9](./screens/7.9.png)





















